# 数仓中各层级的内容及设计

## ODS层

```
-- ODS层
    -- Operate Date Store
        -- 存储从mysql业务数据库和日志服务器的日志文件中采集到的数据
            -- 日志数据
                -- 格式： JSON
            -- 业务数据
                -- 历史数据
                -- 格式：
                    -- 全量
                        -- Datax :TSV
                    -- 增量
                        -- maxwell: JSON
        -- 汇总数据
            -- 希望用最少的资源存储最多的数据
                -- 压缩 gzip
                    -- gzip: Hadoop默认支持
    -- 命名规范
        -- 在数据仓库中，表其实都是放置在一起的，从逻辑上进行区分，进行分层
        -- 表从名称上区分每一层
        -- 分层标记(ods_) + 同步数据的表名称 + 全量/增量 标识 (inc/full)
```

## DWD层

```
-- DWD data warehouse detail
    -- 对ods层数据进行加工 为统计分析做准备
    -- DIM层主要功能其实是分析数据 面向状态
    -- DWD层主要功能其实是统计数据 面向行为
    -- DWD层的表中主要保存的是业务行为数据，表的设计需要遵循建模理论 - 维度建模 - 事实（行为）表
    -- 数据存储格式：列式存储 snappy压缩
    -- DWD层表名的命名规范为
        -- (分层标记)dwd + 数据域(分类) + 行为 + 单分区增量全量标识（inc/full）
-- 交易域加购事务事实表
```

## DIM层

```
-- DIM层
    -- Dimension ：维度
    -- 分析数据的角度表
    -- DIM层的数据存储格式为orc列式存储+snappy压缩
    -- DIM层表名的命名规范为dim_表名_全量表或者拉链表标识（full/zip）
```

## ADS层

```
-- ADS层
    -- Application Data Service
        -- Application：（数据仓库）应用
        -- Data：用户需求的统计结果数据
        -- Service：对外服务
        -- 1、ADS层保存的数据是最终的统计结果
            -- 不需要列式存储，也不需要snappy压缩
        -- 2、统计结果的目的是对外提供服务，所以表不会最终存储的位置
            -- 需要将表中的数据同步到第三方存储(mysql)
                -- ADS层的表最好是行式存储：tsv(DataX)
                -- 压缩格式采用默认的gzip
        -- 3、统计结果的数据量不会很多
            -- ADS层的表不需要分区设计
        -- 4、表的设计
            -- ODS层：表的结构依托于数据源的数据结构(ER模型)
            -- DIM层：遵循维度模型的维度表的设计理念(维度越丰富越好)
            -- DWD层：遵循维度模型的事实表的设计理念(粒度越细越好)
            -- ADS层：客户需要什么，加什么，不要额外添加
    -- 基础概念
        -- 维度：分析数据的角度
        -- 粒度：描述数据的详细程度
        -- 统计周期：统计的时候，数据统计时间范围
        -- 统计粒度：分析数据的角度，称之为统计粒度（站在哪个角度统计数据）
        -- 指标：客户想要的一个结果数值

-- 各品牌的商品下单统计
    -- 统计的行为：下单
    -- 分析的角度：品牌
    -- 指标：下单数量，下单人数
    --建表语句
        -- 统计日期：以获取数据的那一天为准(包含数据的那一天)
-- 各品牌商品下单统计
```

## DWS层

```
-- DWS层
    -- Data Warehouse Summary
        -- 数据仓库
        -- Summary：汇总（预聚合）
            -- 用于将DIM,DWD的数据进行提前统计，将结果统计保存在当前表中
            -- 当前表不是最终的统计结果表
                -- 数据量可能很多，表的设计需要添加分区
                -- 当前表需要进一步聚合处理，所以表的设计中应该是列式存储，且采用snappy压缩
            -- 表的分类：根据数据的范围进行分类
                -- 1d:1天的数据统计
                    -- 数据来源为DIM,DWD
                -- nd:N天的数据统计
                    -- 数据来源必须为1d表
                -- td:所有的数据的统计
                    -- 数据来源可以为1d表
                    -- 数据来源也可以为DIM,DWD
    -- 表的设计
        -- 参考ADS层的表的设计
            -- 指标体系：
                -- 原子指标(拆分指标)
                    -- 行为：统计字段，统计逻辑
                -- 派生指标(增加条件)
                    -- 统计周期(范围) + 业务限定(条件) + 统计粒度(分组维度)
                -- 衍生指标(比率，比例)
        -- 命名规则：
            -- (分层标记)dws+数据域+统计粒度+业务过程+统计周期(1d,nd,td)
                -- 指标：客户想要的一个统计结果(数值)，满足如下条件，可以将数据放在一张表中
                    -- 业务过程相同：数据来源相同
                    -- 统计周期相同：数据范围相同
                    -- 统计粒度相同：数据含义相同
    -- dws层表的字段在预统计时，如果字段可以跨越天，那么就不能在每天中统计
    -- 因为最终统计需要指定的字段，但提前聚合不能对该数据做统计，为了避免数据丢失，需要在表中增加该字段，而不是统计该字段
```